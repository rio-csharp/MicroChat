@using System.Globalization
@using MicroChat.Client.Models

<div class="sidebar-container">
    <div class="sidebar-header">
        <Icon Height="24" />
        <span>MicroChat</span>
    </div>
    <div class="chat-list">
        @foreach (var conversation in ConversationService.Conversations)
        {
            <div class="chat-item @(conversation.IsStreaming ? "streaming" : "")" @onclick="async () => await SelectChatAsync(conversation.Id)">
                <div class="icon">
                    <Icon IconSlug="@conversation.AIModel?.Provider?.IconSlug" />
                </div>
                <div class="chat-info">
                    <div class="chat-title">
                        @conversation.Title
                        @if (conversation.IsStreaming)
                        {
                            <span class="streaming-indicator" title="正在接收回复...">●</span>
                        }
                    </div>
                    <div class="chat-latest">@conversation.Messages.Last()?.Content</div>
                </div>
                <div class="chat-time" title="@conversation.Messages.Last()?.Time.ToString("f", CultureInfo.CurrentCulture)">
                    @conversation.Messages.Last()?.Time.ToString("HH:mm")
                </div>
                <button class="delete-button" @onclick="async (e) => await DeleteChatAsync(e, conversation.Id)" @onclick:stopPropagation="true">×</button>
            </div>
        }
    </div>
    <button class="new-chat-button" @onclick="CreateNewChatAsync">＋ 新建聊天</button>
</div>
