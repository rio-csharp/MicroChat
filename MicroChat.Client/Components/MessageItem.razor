@using MicroChat.Client.Models
@using MicroChat.Client.Pages

@if (Message.Sender == MessageRole.User)
{
    <div class="message-wrapper user-wrapper">
        <div class="user-time">@Message.Time.ToString("HH:mm")</div>
        <div class="chat-message user-message">
            <div class="message-content">@Content</div>
        </div>
        <div class="message-actions">
            <button class="action-btn" @onclick="CopyMessageAsync" title="复制">
                <MessageItemIcons Name="copy" />
            </button>
            <button class="action-btn delete-btn" @onclick="DeleteMessageAsync" title="删除">
                <MessageItemIcons Name="delete" />
            </button>
        </div>
    </div>
}
else
{
    <div class="message-wrapper bot-wrapper">
        <div class="bot-header">
            <div class="bot-icon">
                <Icon IconSlug="@Message.Model?.Provider?.IconSlug" Height="24" />
            </div>
            <div class="bot-info">
                <span class="bot-model">@(Message.Model?.Name ?? "AI Assistant")</span>
                <span class="bot-time">@Message.Time.ToString("HH:mm")</span>
            </div>
        </div>
        <div class="chat-message bot-message @(IsStreaming ? "streaming" : "")" @ref="_messageElement">
            @if (IsStreaming && _internalIsLoading)
            {
                <div class="message-content loading-content">
                    <div class="loading-dots">
                        <span class="dot"></span>
                        <span class="dot"></span>
                        <span class="dot"></span>
                    </div>
                    <span class="loading-text">正在思考中...</span>
                </div>
            }
            else
            {
                <div class="message-content markdown-content">
                    @((MarkupString)RenderedContent)
                </div>
            }
        </div>
        @if (!IsStreaming)
        {
            <div class="message-actions">
                <button class="action-btn" @onclick="CopyMessageAsync" title="复制">
                    <MessageItemIcons Name="copy" />
                </button>
                <button class="action-btn delete-btn" @onclick="DeleteMessageAsync" title="删除">
                    <MessageItemIcons Name="delete" />
                </button>
            </div>
        }
    </div>
}
